<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£åˆ†æ API æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
            margin-bottom: 15px;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-mode {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        .btn-mode.active {
            background: #667eea;
            color: white;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none !important;
        }
        .result {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        .result h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }
        .result pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.5;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .key-point {
            background: #e8f4fd;
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #2196F3;
            border-radius: 3px;
        }
        .keyword-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            margin: 3px;
            font-size: 12px;
        }
        .chat-message {
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .user-message {
            background: #667eea;
            color: white;
            text-align: right;
        }
        .ai-message {
            background: #f0f0f0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š æ–‡æ¡£åˆ†æ API æµ‹è¯•å·¥å…·</h1>
        <p class="subtitle">æµ‹è¯• AI æ–‡æ¡£æ‘˜è¦å’Œå¯¹è¯åŠŸèƒ½</p>

        <!-- æµ‹è¯•1: æ–‡æ¡£æ‘˜è¦ -->
        <div class="test-section">
            <h2>ğŸ” æµ‹è¯• 1: æ–‡æ¡£æ‘˜è¦ç”Ÿæˆ</h2>
            
            <textarea id="summaryInput" rows="10" placeholder="ç²˜è´´æ–‡æ¡£å†…å®¹...

ç¤ºä¾‹å†…å®¹ï¼š
ç¼–è¯‘åŸç†æ˜¯è®¡ç®—æœºç§‘å­¦çš„æ ¸å¿ƒè¯¾ç¨‹ä¹‹ä¸€ï¼Œç ”ç©¶å¦‚ä½•å°†é«˜çº§ç¼–ç¨‹è¯­è¨€è½¬æ¢ä¸ºæœºå™¨å¯æ‰§è¡Œçš„ä»£ç ã€‚æœ¬è¯¾ç¨‹ä¸»è¦åŒ…æ‹¬è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä¸­é—´ä»£ç ç”Ÿæˆã€ä»£ç ä¼˜åŒ–å’Œç›®æ ‡ä»£ç ç”Ÿæˆç­‰å†…å®¹ã€‚è¯æ³•åˆ†æè´Ÿè´£å°†æºç¨‹åºåˆ†è§£æˆä¸€ä¸ªä¸ªæœ‰æ„ä¹‰çš„è¯æ³•å•å…ƒï¼ˆtokenï¼‰ï¼Œè¯­æ³•åˆ†æåˆ™æ ¹æ®è¯­è¨€çš„æ–‡æ³•è§„åˆ™ï¼Œåˆ¤æ–­æºç¨‹åºçš„ç»“æ„æ˜¯å¦æ­£ç¡®ï¼Œå¹¶ç”Ÿæˆè¯­æ³•æ ‘ã€‚è¯­ä¹‰åˆ†ææ£€æŸ¥ç¨‹åºæ˜¯å¦ç¬¦åˆè¯­è¨€çš„è¯­ä¹‰è§„å®šï¼Œå¦‚ç±»å‹æ£€æŸ¥ã€ä½œç”¨åŸŸåˆ†æç­‰ã€‚ä¸­é—´ä»£ç ç”Ÿæˆé˜¶æ®µå°†è¯­æ³•æ ‘è½¬æ¢ä¸ºä¸­é—´è¡¨ç¤ºå½¢å¼ï¼Œä¾¿äºåç»­çš„ä¼˜åŒ–å’Œç›®æ ‡ä»£ç ç”Ÿæˆã€‚ä»£ç ä¼˜åŒ–çš„ç›®æ ‡æ˜¯åœ¨ä¿è¯ç¨‹åºè¯­ä¹‰ä¸å˜çš„å‰æä¸‹ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡æˆ–å‡å°ä»£ç ä½“ç§¯ã€‚æœ€åï¼Œç›®æ ‡ä»£ç ç”Ÿæˆå°†ä¼˜åŒ–åçš„ä¸­é—´ä»£ç ç¿»è¯‘æˆç‰¹å®šæœºå™¨æˆ–è™šæ‹Ÿæœºçš„æŒ‡ä»¤åºåˆ—ã€‚"></textarea>
            
            <div class="button-group">
                <button class="btn-mode" data-mode="brief" onclick="selectMode('brief')">ç®€æ˜æ¨¡å¼</button>
                <button class="btn-mode active" data-mode="detailed" onclick="selectMode('detailed')">è¯¦ç»†æ¨¡å¼</button>
                <button class="btn-mode" data-mode="keypoints" onclick="selectMode('keypoints')">è¦ç‚¹æ¨¡å¼</button>
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="testSummary()">ğŸš€ ç”Ÿæˆæ‘˜è¦</button>
                <button class="btn-secondary" onclick="document.getElementById('summaryInput').value=''">æ¸…ç©º</button>
            </div>
            
            <div id="summaryResult" class="result" style="display:none;"></div>
        </div>

        <!-- æµ‹è¯•2: æ–‡æ¡£å¯¹è¯ -->
        <div class="test-section">
            <h2>ğŸ’¬ æµ‹è¯• 2: æ–‡æ¡£å¯¹è¯</h2>
            
            <textarea id="chatContext" rows="8" placeholder="ç²˜è´´æ–‡æ¡£å†…å®¹ä½œä¸ºå¯¹è¯ä¸Šä¸‹æ–‡...

ä½¿ç”¨ä¸Šé¢çš„æ‘˜è¦æµ‹è¯•æ–‡æ¡£ï¼Œæˆ–è€…ç²˜è´´æ–°çš„å†…å®¹"></textarea>
            
            <div style="margin: 15px 0;">
                <input type="text" id="chatQuestion" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." 
                       style="width: calc(100% - 140px); padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                <button class="btn-primary" onclick="testChat()" style="width: 130px; margin-left: 10px;">å‘é€</button>
            </div>
            
            <div class="button-group">
                <button class="btn-secondary" onclick="askExample('è¿™ç¯‡æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ')">ç¤ºä¾‹: æ ¸å¿ƒå†…å®¹</button>
                <button class="btn-secondary" onclick="askExample('è¯æ³•åˆ†æçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ')">ç¤ºä¾‹: è¯æ³•åˆ†æ</button>
                <button class="btn-secondary" onclick="askExample('å¦‚ä½•å­¦ä¹ ç¼–è¯‘åŸç†ï¼Ÿ')">ç¤ºä¾‹: å­¦ä¹ å»ºè®®</button>
            </div>
            
            <div id="chatResult" class="result" style="display:none;"></div>
        </div>

        <!-- API çŠ¶æ€ -->
        <div class="test-section">
            <h2>âš™ï¸ API çŠ¶æ€</h2>
            <p>API åœ°å€: <code>http://localhost:8080/api</code></p>
            <p id="apiStatus">çŠ¶æ€: å‡†å¤‡å°±ç»ª</p>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let currentMode = 'detailed';
        let chatHistory = [];

        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.btn-mode').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
        }

        async function testSummary() {
            const content = document.getElementById('summaryInput').value.trim();
            if (!content) {
                alert('è¯·è¾“å…¥æ–‡æ¡£å†…å®¹ï¼');
                return;
            }

            const resultDiv = document.getElementById('summaryResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> æ­£åœ¨ç”Ÿæˆæ‘˜è¦...';

            try {
                const response = await fetch(`${API_BASE}/ai/summarize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: content,
                        type: 'text',
                        mode: currentMode
                    })
                });

                const result = await response.json();
                
                if (result.code === 0) {
                    displaySummary(result.data);
                } else {
                    resultDiv.innerHTML = `<h3>âŒ é”™è¯¯</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<h3>âŒ è¯·æ±‚å¤±è´¥</h3><p>${error.message}</p>`;
                console.error('Error:', error);
            }
        }

        function displaySummary(data) {
            const resultDiv = document.getElementById('summaryResult');
            
            let html = '<h3>âœ… æ‘˜è¦ç”ŸæˆæˆåŠŸ</h3>';
            
            if (data.title) {
                html += `<h2 style="color: #333; margin-top: 15px;">${data.title}</h2>`;
            }
            
            html += `<p style="color: #666; margin: 10px 0;">
                ğŸ“Š ${data.wordCount || 0} å­— | â±ï¸ ${data.estimatedTime || 'æœªçŸ¥'} | 
                éš¾åº¦: ${getDifficultyBadge(data.difficulty)}
            </p>`;
            
            html += `<div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                <h4 style="color: #2196F3; margin-bottom: 10px;">ğŸ’¡ æ ¸å¿ƒæ‘˜è¦</h4>
                <p style="line-height: 1.6;">${data.summary}</p>
            </div>`;
            
            if (data.keyPoints && data.keyPoints.length) {
                html += '<h4 style="margin-top: 20px;">ğŸ¯ å…³é”®è¦ç‚¹</h4>';
                data.keyPoints.forEach((point, i) => {
                    html += `<div class="key-point">${i + 1}. ${point}</div>`;
                });
            }
            
            if (data.keywords && data.keywords.length) {
                html += '<h4 style="margin-top: 20px;">ğŸ·ï¸ å…³é”®è¯</h4><div>';
                data.keywords.forEach(keyword => {
                    html += `<span class="keyword-tag">${keyword}</span>`;
                });
                html += '</div>';
            }
            
            if (data.suggestions && data.suggestions.length) {
                html += '<h4 style="margin-top: 20px;">ğŸ“ å­¦ä¹ å»ºè®®</h4><ul style="padding-left: 20px;">';
                data.suggestions.forEach(suggestion => {
                    html += `<li style="margin: 5px 0;">${suggestion}</li>`;
                });
                html += '</ul>';
            }
            
            resultDiv.innerHTML = html;
        }

        function getDifficultyBadge(difficulty) {
            const badges = {
                'easy': 'ğŸŸ¢ ç®€å•',
                'medium': 'ğŸŸ¡ ä¸­ç­‰',
                'hard': 'ğŸ”´ å›°éš¾'
            };
            return badges[difficulty] || difficulty;
        }

        async function testChat() {
            const context = document.getElementById('chatContext').value.trim();
            const question = document.getElementById('chatQuestion').value.trim();
            
            if (!context && chatHistory.length === 0) {
                alert('è¯·å…ˆè¾“å…¥æ–‡æ¡£å†…å®¹ä½œä¸ºå¯¹è¯ä¸Šä¸‹æ–‡ï¼');
                return;
            }
            
            if (!question) {
                alert('è¯·è¾“å…¥é—®é¢˜ï¼');
                return;
            }

            const resultDiv = document.getElementById('chatResult');
            resultDiv.style.display = 'block';
            
            // æ˜¾ç¤ºç”¨æˆ·é—®é¢˜
            chatHistory.push({ role: 'user', content: question });
            updateChatDisplay();
            
            // æ¸…ç©ºè¾“å…¥
            document.getElementById('chatQuestion').value = '';
            
            // æ˜¾ç¤ºåŠ è½½
            resultDiv.innerHTML += '<div class="chat-message ai-message"><div class="loading"></div> AI æ­£åœ¨æ€è€ƒ...</div>';

            try {
                const response = await fetch(`${API_BASE}/ai/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        documentId: 'test-doc-' + Date.now(),
                        question: question,
                        context: chatHistory.length === 1 ? context : undefined,
                        history: chatHistory.slice(0, -1)
                    })
                });

                const result = await response.json();
                
                if (result.code === 0) {
                    chatHistory.push({ role: 'assistant', content: result.data.answer });
                    updateChatDisplay();
                } else {
                    resultDiv.innerHTML += `<div class="chat-message ai-message">âŒ é”™è¯¯: ${result.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML += `<div class="chat-message ai-message">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
                console.error('Error:', error);
            }
        }

        function updateChatDisplay() {
            const resultDiv = document.getElementById('chatResult');
            let html = '<h3>ğŸ’¬ å¯¹è¯è®°å½•</h3>';
            
            chatHistory.forEach(msg => {
                const className = msg.role === 'user' ? 'user-message' : 'ai-message';
                html += `<div class="chat-message ${className}">${msg.content}</div>`;
            });
            
            resultDiv.innerHTML = html;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        }

        function askExample(question) {
            document.getElementById('chatQuestion').value = question;
        }

        // æµ‹è¯• API è¿æ¥
        async function testConnection() {
            try {
                const response = await fetch(`${API_BASE}/../health`);
                const data = await response.json();
                document.getElementById('apiStatus').innerHTML = 
                    `çŠ¶æ€: <span style="color: green;">âœ… ${data.message}</span>`;
            } catch (error) {
                document.getElementById('apiStatus').innerHTML = 
                    `çŠ¶æ€: <span style="color: red;">âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨</span>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æµ‹è¯•è¿æ¥
        testConnection();
    </script>
</body>
</html>
