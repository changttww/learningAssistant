-- ============================================
-- 答辩演示数据 - 知识图谱 & 关系挖掘
-- 执行前请确保已有用户数据 (user_id = 1)
-- ============================================

SET NAMES utf8mb4;
SET CHARACTER SET utf8mb4;

-- 清理旧的演示数据
DELETE FROM knowledge_relations WHERE user_id = 1;
DELETE FROM knowledge_vector_caches WHERE entry_id IN (SELECT id FROM knowledge_base_entries WHERE user_id = 1 AND id >= 100);
DELETE FROM study_notes WHERE user_id = 1 AND id >= 1000;
DELETE FROM knowledge_base_entries WHERE user_id = 1 AND id >= 100;
DELETE FROM tasks WHERE id >= 100 AND id <= 700 AND created_by = 1;

-- ============================================
-- 1. 插入知识库条目（6大分类，展示聚类效果）
-- ============================================

INSERT INTO knowledge_base_entries (id, user_id, source_type, source_id, task_id, title, content, summary, keywords, category, sub_category, subject, level, status, view_count, display_color, display_icon, created_at, updated_at) VALUES

-- ===== 计算机类 (5个) =====
(101, 1, 1, 101, 101, 'Python基础语法', 
'【任务描述】学习Python的基础语法，包括变量定义、数据类型、条件语句、循环语句等。
【学习笔记】
# Python变量与数据类型
Python是动态类型语言，变量不需要声明类型。基本数据类型包括：int整数、float浮点数、str字符串、bool布尔值、list列表、dict字典等。
# 条件与循环
if-elif-else条件判断，for和while循环语句，break和continue控制流程。',
'Python基础语法学习笔记，涵盖变量、数据类型、条件判断、循环语句等核心概念', 
'["Python","变量","数据类型","循环","条件"]', 
'计算机', '编程语言', '实操应用', 3, 1, 15, '#3b82f6', 'code', NOW(), NOW()),

(102, 1, 1, 102, 102, '数据结构-链表', 
'【任务描述】理解链表数据结构的原理与实现
【学习笔记】
# 单链表
链表是一种线性数据结构，每个节点包含数据域和指针域。单链表只能单向遍历。
# 双链表
双链表每个节点有前驱和后继两个指针，支持双向遍历。
# 常见操作
插入O(1)、删除O(1)、查找O(n)、反转链表等。',
'链表数据结构学习：单链表、双链表的原理与常见操作实现',
'["链表","数据结构","指针","节点","算法"]',
'计算机', '数据结构', '逻辑思维', 2, 1, 12, '#3b82f6', 'code', NOW(), NOW()),

(103, 1, 1, 103, 103, 'MySQL数据库基础', 
'【任务描述】学习关系型数据库MySQL的基本使用
【学习笔记】
# SQL基础
SELECT查询、INSERT插入、UPDATE更新、DELETE删除四大操作。
# 表设计
主键、外键、索引、约束的概念与使用。
# 事务
ACID特性：原子性、一致性、隔离性、持久性。',
'MySQL数据库基础：SQL语法、表设计、索引优化与事务管理',
'["MySQL","SQL","数据库","索引","事务"]',
'计算机', '数据库', '实操应用', 2, 1, 18, '#3b82f6', 'code', NOW(), NOW()),

(104, 1, 1, 104, 104, '计算机网络-TCP/IP', 
'【任务描述】理解TCP/IP协议栈的工作原理
【学习笔记】
# OSI七层模型
物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。
# TCP协议
三次握手建立连接，四次挥手断开连接。可靠传输、流量控制、拥塞控制。
# IP协议
IP地址分类、子网划分、路由选择。',
'TCP/IP协议栈详解：OSI模型、TCP三次握手、IP地址与路由',
'["TCP","IP","网络协议","三次握手","路由"]',
'计算机', '计算机网络', '理论素养', 1, 1, 8, '#3b82f6', 'code', NOW(), NOW()),

(105, 1, 1, 105, 105, '算法-动态规划', 
'【任务描述】掌握动态规划算法思想
【学习笔记】
# 核心思想
将复杂问题分解为重叠子问题，通过存储子问题的解避免重复计算。
# 解题步骤
1. 定义状态 2. 状态转移方程 3. 初始条件 4. 计算顺序
# 经典问题
背包问题、最长公共子序列、编辑距离、股票买卖问题。',
'动态规划算法：核心思想、解题模板与经典问题分析',
'["动态规划","算法","状态转移","背包问题","LCS"]',
'计算机', '算法', '逻辑思维', 1, 1, 20, '#3b82f6', 'code', NOW(), NOW()),

-- ===== 数理逻辑类 (4个) =====
(201, 1, 1, 201, 201, '高等数学-微积分', 
'【任务描述】学习微积分的基本概念与计算方法
【学习笔记】
# 极限
函数极限的定义、性质与计算，无穷小与无穷大。
# 导数
导数的几何意义、求导法则、高阶导数、隐函数求导。
# 积分
不定积分、定积分、换元积分法、分部积分法。',
'微积分基础：极限、导数、积分的概念与计算方法',
'["微积分","极限","导数","积分","高等数学"]',
'数理逻辑', '微积分', '逻辑思维', 2, 1, 14, '#8b5cf6', 'calculator', NOW(), NOW()),

(202, 1, 1, 202, 202, '线性代数-矩阵', 
'【任务描述】掌握矩阵运算与线性变换
【学习笔记】
# 矩阵运算
矩阵加法、乘法、转置、逆矩阵的求解。
# 行列式
行列式的性质与计算，克莱姆法则。
# 特征值与特征向量
特征方程、特征值分解、矩阵对角化。',
'线性代数：矩阵运算、行列式、特征值与特征向量',
'["矩阵","线性代数","行列式","特征值","向量"]',
'数理逻辑', '线性代数', '逻辑思维', 2, 1, 11, '#8b5cf6', 'calculator', NOW(), NOW()),

(203, 1, 1, 203, 203, '概率论-随机变量', 
'【任务描述】学习概率论中随机变量的概念
【学习笔记】
# 离散随机变量
伯努利分布、二项分布、泊松分布。
# 连续随机变量
均匀分布、正态分布、指数分布。
# 数字特征
期望、方差、协方差、相关系数。',
'概率论：随机变量的分布与数字特征',
'["概率论","随机变量","正态分布","期望","方差"]',
'数理逻辑', '概率论', '逻辑思维', 1, 1, 9, '#8b5cf6', 'calculator', NOW(), NOW()),

(204, 1, 1, 204, 204, '离散数学-图论', 
'【任务描述】学习图论的基本概念
【学习笔记】
# 图的基本概念
顶点、边、度、路径、环、连通性。
# 特殊图
完全图、二分图、树、森林。
# 图算法
DFS深度优先、BFS广度优先、最短路径、最小生成树。',
'图论基础：图的表示、遍历算法与经典问题',
'["图论","DFS","BFS","最短路径","生成树"]',
'数理逻辑', '离散数学', '逻辑思维', 1, 1, 7, '#8b5cf6', 'calculator', NOW(), NOW()),

-- ===== 人文社科类 (3个) =====
(301, 1, 1, 301, 301, '英语写作技巧', 
'【任务描述】提升英语学术写作能力
【学习笔记】
# 段落结构
Topic Sentence主题句 + Supporting Details论据 + Conclusion结论。
# 连接词
因果：because, therefore; 转折：however, although; 递进：moreover, furthermore。
# 学术用语
避免口语化表达，使用正式词汇和被动语态。',
'英语学术写作：段落结构、连接词使用与学术表达规范',
'["英语","写作","学术","段落","连接词"]',
'人文社科', '英语', '沟通表达', 2, 1, 16, '#f59e0b', 'book', NOW(), NOW()),

(302, 1, 1, 302, 302, '中国现当代文学', 
'【任务描述】了解中国现当代文学发展脉络
【学习笔记】
# 五四文学
鲁迅《呐喊》、郭沫若《女神》开创新文学。
# 现代文学
老舍《骆驼祥子》、巴金《家》、茅盾《子夜》。
# 当代文学
莫言、余华、贾平凹等作家的创作特色。',
'中国现当代文学：五四新文学到当代文学的发展历程',
'["文学","鲁迅","现代文学","当代文学","小说"]',
'人文社科', '文学', '理论素养', 1, 1, 6, '#f59e0b', 'book', NOW(), NOW()),

(303, 1, 1, 303, 303, '逻辑学基础', 
'【任务描述】学习形式逻辑的基本原理
【学习笔记】
# 命题逻辑
命题、联结词、真值表、逻辑等价。
# 推理形式
演绎推理、归纳推理、类比推理。
# 逻辑谬误
偷换概念、以偏概全、诉诸权威、稻草人谬误。',
'逻辑学：命题逻辑、推理形式与常见逻辑谬误分析',
'["逻辑","命题","推理","谬误","思维"]',
'人文社科', '哲学', '逻辑思维', 2, 1, 10, '#f59e0b', 'book', NOW(), NOW()),

-- ===== 自然科学类 (2个) =====
(401, 1, 1, 401, 401, '有机化学-官能团', 
'【任务描述】掌握有机化学中常见官能团的性质
【学习笔记】
# 烃类
烷烃、烯烃、炔烃、芳香烃的结构与性质。
# 含氧官能团
醇、醛、酮、羧酸、酯的反应特点。
# 有机反应
取代反应、加成反应、消除反应、氧化还原反应。',
'有机化学：官能团的分类、性质与有机反应类型',
'["有机化学","官能团","烃","醇","酯"]',
'自然科学', '化学', '理论素养', 1, 1, 5, '#10b981', 'flask', NOW(), NOW()),

(402, 1, 1, 402, 402, '分子生物学-DNA复制', 
'【任务描述】理解DNA复制的分子机制
【学习笔记】
# 复制起点
复制起始位点(ori)的识别与解旋。
# 复制过程
DNA聚合酶、引物酶、连接酶的协同作用。领先链与滞后链的半不连续复制。
# 复制保真性
校对功能、错配修复机制。',
'DNA复制：复制机制、参与酶类与复制保真性',
'["DNA","复制","分子生物学","聚合酶","遗传"]',
'自然科学', '生物', '理论素养', 1, 1, 4, '#10b981', 'flask', NOW(), NOW()),

-- ===== 经济管理类 (2个) =====
(501, 1, 1, 501, 501, '微观经济学-供需理论', 
'【任务描述】学习供给与需求的基本原理
【学习笔记】
# 需求
需求曲线、需求弹性、消费者剩余。
# 供给
供给曲线、生产成本、生产者剩余。
# 市场均衡
均衡价格、均衡数量、价格机制的调节作用。',
'微观经济学：供需曲线、弹性分析与市场均衡',
'["经济学","供给","需求","均衡","弹性"]',
'经济管理', '经济学', '逻辑思维', 2, 1, 8, '#ef4444', 'chart', NOW(), NOW()),

(502, 1, 1, 502, 502, '项目管理基础', 
'【任务描述】掌握项目管理的核心方法
【学习笔记】
# 项目生命周期
启动、规划、执行、监控、收尾五个阶段。
# 进度管理
WBS工作分解、甘特图、关键路径法(CPM)、PERT。
# 敏捷方法
Scrum框架、Sprint迭代、每日站会、回顾会议。',
'项目管理：生命周期、进度控制与敏捷开发方法',
'["项目管理","WBS","甘特图","Scrum","敏捷"]',
'经济管理', '管理学', '实操应用', 2, 1, 12, '#ef4444', 'chart', NOW(), NOW()),

-- ===== 艺术体育类 (2个) =====
(601, 1, 1, 601, 601, 'UI设计原则', 
'【任务描述】学习用户界面设计的基本原则
【学习笔记】
# 设计原则
一致性、反馈、可见性、容错性、简约性。
# 色彩理论
色彩心理学、配色方案、对比度与可读性。
# 布局设计
栅格系统、留白、视觉层次、F型/Z型阅读模式。',
'UI设计：设计原则、色彩理论与界面布局技巧',
'["UI设计","用户界面","色彩","布局","交互"]',
'艺术体育', '设计', '创新思维', 2, 1, 14, '#ec4899', 'palette', NOW(), NOW()),

(602, 1, 1, 602, 602, '健身训练计划', 
'【任务描述】制定科学的健身训练方案
【学习笔记】
# 训练原则
渐进超负荷、专项性、恢复原则。
# 力量训练
复合动作（深蹲、硬拉、卧推）、分化训练。
# 有氧训练
心率区间、HIIT高强度间歇、有氧耐力训练。',
'健身训练：训练原则、力量训练与有氧运动规划',
'["健身","训练","力量","有氧","运动"]',
'艺术体育', '体育', '实操应用', 3, 1, 10, '#ec4899', 'dumbbell', NOW(), NOW());

-- ============================================
-- 2. 插入知识关系（展示AI挖掘效果）
-- ============================================

INSERT INTO knowledge_relations (user_id, source_entry_id, target_entry_id, relation_type, strength, created_at, updated_at) VALUES

-- 前置关系 (relation_type = 1): source 是 target 的前置知识
(1, 101, 102, 1, 0.85, NOW(), NOW()),  -- Python基础 → 数据结构链表 (需要先学编程基础)
(1, 101, 103, 1, 0.80, NOW(), NOW()),  -- Python基础 → MySQL数据库 (编程基础)
(1, 102, 105, 1, 0.90, NOW(), NOW()),  -- 数据结构链表 → 动态规划 (需要数据结构基础)
(1, 201, 202, 1, 0.85, NOW(), NOW()),  -- 微积分 → 线性代数 (数学基础)
(1, 201, 203, 1, 0.80, NOW(), NOW()),  -- 微积分 → 概率论 (需要微积分)
(1, 204, 105, 1, 0.75, NOW(), NOW()),  -- 离散数学图论 → 动态规划 (图论是DP基础)

-- 相关关系 (relation_type = 2): 同层级相关概念
(1, 102, 204, 2, 0.70, NOW(), NOW()),   -- 数据结构链表 ↔ 图论 (都是数据结构)
(1, 103, 104, 2, 0.65, NOW(), NOW()),   -- MySQL ↔ TCP/IP (后端技术栈)
(1, 202, 203, 2, 0.75, NOW(), NOW()),   -- 线性代数 ↔ 概率论 (数学分支)
(1, 301, 303, 2, 0.60, NOW(), NOW()),   -- 英语写作 ↔ 逻辑学 (表达与思维)
(1, 501, 502, 2, 0.70, NOW(), NOW()),   -- 微观经济学 ↔ 项目管理 (管理领域)
(1, 401, 402, 2, 0.80, NOW(), NOW()),   -- 有机化学 ↔ 分子生物学 (生化交叉)

-- 扩展关系 (relation_type = 3): source 是 target 的扩展应用
(1, 101, 601, 3, 0.55, NOW(), NOW()),  -- Python基础 → UI设计 (前端开发可用Python)
(1, 203, 105, 3, 0.70, NOW(), NOW()),  -- 概率论 → 动态规划 (概率DP)
(1, 303, 105, 3, 0.65, NOW(), NOW());  -- 逻辑学 → 动态规划 (逻辑推理能力)

-- ============================================
-- 3. 更新用户知识库统计
-- ============================================

INSERT INTO user_knowledge_stats (user_id, total_entries, mastered_count, learning_count, to_learn_count, last_update_at, created_at, updated_at)
VALUES (1, 18, 2, 10, 6, NOW(), NOW(), NOW())
ON DUPLICATE KEY UPDATE
  total_entries = 18,
  mastered_count = 2,
  learning_count = 10,
  to_learn_count = 6,
  last_update_at = NOW(),
  updated_at = NOW();

-- ============================================
-- 4. 插入对应的任务数据（让知识点有来源）
-- ============================================

INSERT INTO tasks (id, title, description, task_type, priority, status, estimate_minutes, due_at, created_by, owner_user_id, created_at, updated_at) VALUES
(101, 'Python基础语法', '学习Python的基础语法', 1, 2, 3, 120, DATE_ADD(NOW(), INTERVAL 7 DAY), 1, 1, NOW(), NOW()),
(102, '数据结构-链表', '理解链表数据结构的原理与实现', 1, 2, 2, 90, DATE_ADD(NOW(), INTERVAL 10 DAY), 1, 1, NOW(), NOW()),
(103, 'MySQL数据库基础', '学习关系型数据库MySQL的基本使用', 1, 2, 2, 150, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(104, '计算机网络-TCP/IP', '理解TCP/IP协议栈的工作原理', 1, 1, 1, 120, DATE_ADD(NOW(), INTERVAL 21 DAY), 1, 1, NOW(), NOW()),
(105, '算法-动态规划', '掌握动态规划算法思想', 1, 3, 1, 180, DATE_ADD(NOW(), INTERVAL 30 DAY), 1, 1, NOW(), NOW()),
(201, '高等数学-微积分', '学习微积分的基本概念与计算方法', 1, 2, 2, 180, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(202, '线性代数-矩阵', '掌握矩阵运算与线性变换', 1, 2, 2, 150, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(203, '概率论-随机变量', '学习概率论中随机变量的概念', 1, 1, 1, 120, DATE_ADD(NOW(), INTERVAL 21 DAY), 1, 1, NOW(), NOW()),
(204, '离散数学-图论', '学习图论的基本概念', 1, 1, 1, 90, DATE_ADD(NOW(), INTERVAL 21 DAY), 1, 1, NOW(), NOW()),
(301, '英语写作技巧', '提升英语学术写作能力', 1, 2, 2, 90, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(302, '中国现当代文学', '了解中国现当代文学发展脉络', 1, 1, 1, 120, DATE_ADD(NOW(), INTERVAL 30 DAY), 1, 1, NOW(), NOW()),
(303, '逻辑学基础', '学习形式逻辑的基本原理', 1, 2, 2, 90, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(401, '有机化学-官能团', '掌握有机化学中常见官能团的性质', 1, 1, 1, 120, DATE_ADD(NOW(), INTERVAL 21 DAY), 1, 1, NOW(), NOW()),
(402, '分子生物学-DNA复制', '理解DNA复制的分子机制', 1, 1, 1, 90, DATE_ADD(NOW(), INTERVAL 21 DAY), 1, 1, NOW(), NOW()),
(501, '微观经济学-供需理论', '学习供给与需求的基本原理', 1, 2, 2, 120, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(502, '项目管理基础', '掌握项目管理的核心方法', 1, 2, 2, 90, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(601, 'UI设计原则', '学习用户界面设计的基本原则', 1, 2, 2, 120, DATE_ADD(NOW(), INTERVAL 14 DAY), 1, 1, NOW(), NOW()),
(602, '健身训练计划', '制定科学的健身训练方案', 1, 2, 3, 60, DATE_ADD(NOW(), INTERVAL 7 DAY), 1, 1, NOW(), NOW())
ON DUPLICATE KEY UPDATE updated_at = NOW();

-- ============================================
-- 5. 插入学习笔记（丰富知识点内容）
-- ============================================

INSERT INTO study_notes (id, user_id, task_id, title, content, created_at, updated_at) VALUES
(1001, 1, 101, 'Python学习心得', '<p>Python的语法非常简洁优雅，适合初学者入门。</p><p>重点掌握：列表推导式、字典操作、函数定义与调用。</p>', NOW(), NOW()),
(1002, 1, 102, '链表操作总结', '<p>链表的关键是理解指针操作。</p><ul><li>插入：修改前后节点的指针</li><li>删除：跳过目标节点</li><li>反转：迭代或递归实现</li></ul>', NOW(), NOW()),
(1003, 1, 105, '动态规划解题模板', '<p>DP五步法：</p><ol><li>确定状态定义</li><li>写出状态转移方程</li><li>确定初始条件</li><li>确定遍历顺序</li><li>返回最终结果</li></ol>', NOW(), NOW())
ON DUPLICATE KEY UPDATE updated_at = NOW();

-- ============================================
-- 完成提示
-- ============================================
SELECT '✅ 答辩演示数据插入完成！' AS message;
SELECT CONCAT('📊 知识库条目: ', COUNT(*), ' 条') AS stats FROM knowledge_base_entries WHERE user_id = 1;
SELECT CONCAT('🔗 知识关系: ', COUNT(*), ' 条') AS stats FROM knowledge_relations WHERE user_id = 1;
