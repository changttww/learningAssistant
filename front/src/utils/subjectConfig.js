/**
 * å­¦ç§‘åˆ†ç±»æ˜¾ç¤ºé…ç½® - é¢å‘å­¦ä¹ åŠ©æ‰‹
 * ä¸ºæ¯ä¸ªå­¦ç§‘æä¾›ç‰¹è‰²åŒ–çš„é¢œè‰²ã€å›¾æ ‡å’Œæ ·å¼é…ç½®
 */

// å­¦ç§‘æ˜¾ç¤ºé…ç½®è¡¨
export const subjectConfigs = {
  // ç†ç§‘ç±»
  'æ•°å­¦': {
    color: '#3b82f6',
    gradient: 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)',
    icon: 'mdi:calculator-variant',
    emoji: 'ğŸ”¢',
    lightBg: '#eff6ff',
    textColor: '#1e40af',
  },
  'ç‰©ç†': {
    color: '#8b5cf6',
    gradient: 'linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)',
    icon: 'mdi:atom',
    emoji: 'âš›ï¸',
    lightBg: '#f5f3ff',
    textColor: '#5b21b6',
  },
  'åŒ–å­¦': {
    color: '#06b6d4',
    gradient: 'linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)',
    icon: 'mdi:flask-outline',
    emoji: 'ğŸ§ª',
    lightBg: '#ecfeff',
    textColor: '#0e7490',
  },
  'ç”Ÿç‰©': {
    color: '#10b981',
    gradient: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
    icon: 'mdi:dna',
    emoji: 'ğŸ§¬',
    lightBg: '#ecfdf5',
    textColor: '#047857',
  },
  // æ–‡ç§‘ç±»
  'è¯­æ–‡': {
    color: '#f59e0b',
    gradient: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',
    icon: 'mdi:book-open-page-variant',
    emoji: 'ğŸ“–',
    lightBg: '#fffbeb',
    textColor: '#b45309',
  },
  'è‹±è¯­': {
    color: '#ec4899',
    gradient: 'linear-gradient(135deg, #ec4899 0%, #db2777 100%)',
    icon: 'mdi:alphabetical',
    emoji: 'ğŸ—£ï¸',
    lightBg: '#fdf2f8',
    textColor: '#be185d',
  },
  'å†å²': {
    color: '#92400e',
    gradient: 'linear-gradient(135deg, #92400e 0%, #78350f 100%)',
    icon: 'mdi:castle',
    emoji: 'ğŸ›ï¸',
    lightBg: '#fef3c7',
    textColor: '#78350f',
  },
  'åœ°ç†': {
    color: '#16a34a',
    gradient: 'linear-gradient(135deg, #22c55e 0%, #16a34a 100%)',
    icon: 'mdi:earth',
    emoji: 'ğŸŒ',
    lightBg: '#f0fdf4',
    textColor: '#15803d',
  },
  'æ”¿æ²»': {
    color: '#dc2626',
    gradient: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)',
    icon: 'mdi:bank',
    emoji: 'âš–ï¸',
    lightBg: '#fef2f2',
    textColor: '#b91c1c',
  },
  // æŠ€èƒ½ç±»
  'ç¼–ç¨‹': {
    color: '#0ea5e9',
    gradient: 'linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)',
    icon: 'mdi:code-braces',
    emoji: 'ğŸ’»',
    lightBg: '#f0f9ff',
    textColor: '#0369a1',
  },
  'è®¡ç®—æœº': {
    color: '#6366f1',
    gradient: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)',
    icon: 'mdi:laptop',
    emoji: 'ğŸ–¥ï¸',
    lightBg: '#eef2ff',
    textColor: '#4338ca',
  },
  'è‰ºæœ¯': {
    color: '#f472b6',
    gradient: 'linear-gradient(135deg, #f472b6 0%, #ec4899 100%)',
    icon: 'mdi:palette',
    emoji: 'ğŸ¨',
    lightBg: '#fdf2f8',
    textColor: '#db2777',
  },
  'éŸ³ä¹': {
    color: '#a855f7',
    gradient: 'linear-gradient(135deg, #a855f7 0%, #9333ea 100%)',
    icon: 'mdi:music',
    emoji: 'ğŸµ',
    lightBg: '#faf5ff',
    textColor: '#7e22ce',
  },
  'ä½“è‚²': {
    color: '#f97316',
    gradient: 'linear-gradient(135deg, #f97316 0%, #ea580c 100%)',
    icon: 'mdi:basketball',
    emoji: 'âš½',
    lightBg: '#fff7ed',
    textColor: '#c2410c',
  },
  // é€šè¯†ç±»
  'å­¦ä¹ æ–¹æ³•': {
    color: '#14b8a6',
    gradient: 'linear-gradient(135deg, #14b8a6 0%, #0d9488 100%)',
    icon: 'mdi:lightbulb-on',
    emoji: 'ğŸ’¡',
    lightBg: '#f0fdfa',
    textColor: '#0f766e',
  },
  'è€ƒè¯•æŠ€å·§': {
    color: '#eab308',
    gradient: 'linear-gradient(135deg, #eab308 0%, #ca8a04 100%)',
    icon: 'mdi:school',
    emoji: 'ğŸ“',
    lightBg: '#fefce8',
    textColor: '#a16207',
  },
  'é˜…è¯»': {
    color: '#84cc16',
    gradient: 'linear-gradient(135deg, #84cc16 0%, #65a30d 100%)',
    icon: 'mdi:book-open-variant',
    emoji: 'ğŸ“š',
    lightBg: '#f7fee7',
    textColor: '#4d7c0f',
  },
  'å†™ä½œ': {
    color: '#0891b2',
    gradient: 'linear-gradient(135deg, #22d3ee 0%, #0891b2 100%)',
    icon: 'mdi:pencil',
    emoji: 'âœï¸',
    lightBg: '#ecfeff',
    textColor: '#0e7490',
  },
  'æ€ç»´è®­ç»ƒ': {
    color: '#7c3aed',
    gradient: 'linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%)',
    icon: 'mdi:brain',
    emoji: 'ğŸ§ ',
    lightBg: '#f5f3ff',
    textColor: '#6d28d9',
  },
  'é¡¹ç›®': {
    color: '#2563eb',
    gradient: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',
    icon: 'mdi:folder-star',
    emoji: 'ğŸ“‚',
    lightBg: '#eff6ff',
    textColor: '#1d4ed8',
  },
  'ç¬”è®°': {
    color: '#ea580c',
    gradient: 'linear-gradient(135deg, #fb923c 0%, #ea580c 100%)',
    icon: 'mdi:notebook-outline',
    emoji: 'ğŸ““',
    lightBg: '#fff7ed',
    textColor: '#c2410c',
  },
  // é»˜è®¤
  'å…¶ä»–': {
    color: '#64748b',
    gradient: 'linear-gradient(135deg, #94a3b8 0%, #64748b 100%)',
    icon: 'mdi:bookshelf',
    emoji: 'ğŸ“',
    lightBg: '#f1f5f9',
    textColor: '#475569',
  },
  'é»˜è®¤': {
    color: '#64748b',
    gradient: 'linear-gradient(135deg, #94a3b8 0%, #64748b 100%)',
    icon: 'mdi:book',
    emoji: 'ğŸ“–',
    lightBg: '#f1f5f9',
    textColor: '#475569',
  },
};

// å…³é”®è¯åˆ°å­¦ç§‘çš„æ˜ å°„
const keywordMapping = {
  // æ•°å­¦
  'math': 'æ•°å­¦', 'æ•°å­¦': 'æ•°å­¦', 'ä»£æ•°': 'æ•°å­¦', 'å‡ ä½•': 'æ•°å­¦', 'å¾®ç§¯åˆ†': 'æ•°å­¦',
  'å‡½æ•°': 'æ•°å­¦', 'æ–¹ç¨‹': 'æ•°å­¦', 'å…¬å¼': 'æ•°å­¦', 'è®¡ç®—': 'æ•°å­¦', 'æ¦‚ç‡': 'æ•°å­¦', 'ç»Ÿè®¡': 'æ•°å­¦',
  // ç‰©ç†
  'physics': 'ç‰©ç†', 'ç‰©ç†': 'ç‰©ç†', 'åŠ›å­¦': 'ç‰©ç†', 'ç”µå­¦': 'ç‰©ç†', 'ç£å­¦': 'ç‰©ç†',
  'å…‰å­¦': 'ç‰©ç†', 'çƒ­å­¦': 'ç‰©ç†', 'èƒ½é‡': 'ç‰©ç†', 'ç‰›é¡¿': 'ç‰©ç†', 'è¿åŠ¨': 'ç‰©ç†',
  // åŒ–å­¦
  'chemistry': 'åŒ–å­¦', 'åŒ–å­¦': 'åŒ–å­¦', 'å…ƒç´ ': 'åŒ–å­¦', 'åˆ†å­': 'åŒ–å­¦', 'åŸå­': 'åŒ–å­¦',
  'ååº”': 'åŒ–å­¦', 'é…¸ç¢±': 'åŒ–å­¦', 'æœ‰æœº': 'åŒ–å­¦',
  // ç”Ÿç‰©
  'biology': 'ç”Ÿç‰©', 'ç”Ÿç‰©': 'ç”Ÿç‰©', 'ç»†èƒ': 'ç”Ÿç‰©', 'é—ä¼ ': 'ç”Ÿç‰©', 'åŸºå› ': 'ç”Ÿç‰©',
  'ç”Ÿå‘½': 'ç”Ÿç‰©', 'ç”Ÿæ€': 'ç”Ÿç‰©', 'åŠ¨ç‰©': 'ç”Ÿç‰©', 'æ¤ç‰©': 'ç”Ÿç‰©',
  // è¯­æ–‡
  'chinese': 'è¯­æ–‡', 'è¯­æ–‡': 'è¯­æ–‡', 'æ–‡è¨€æ–‡': 'è¯­æ–‡', 'å¤è¯—': 'è¯­æ–‡', 'é˜…è¯»ç†è§£': 'è¯­æ–‡',
  'å†™ä½œ': 'å†™ä½œ', 'ä½œæ–‡': 'è¯­æ–‡', 'æ–‡å­¦': 'è¯­æ–‡', 'è¯—è¯': 'è¯­æ–‡',
  // è‹±è¯­
  'english': 'è‹±è¯­', 'è‹±è¯­': 'è‹±è¯­', 'å•è¯': 'è‹±è¯­', 'è¯­æ³•': 'è‹±è¯­', 'è¯æ±‡': 'è‹±è¯­',
  'å£è¯­': 'è‹±è¯­', 'å¬åŠ›': 'è‹±è¯­', 'ç¿»è¯‘': 'è‹±è¯­',
  // å†å²
  'history': 'å†å²', 'å†å²': 'å†å²', 'æœä»£': 'å†å²', 'æˆ˜äº‰': 'å†å²', 'é©å‘½': 'å†å²',
  'å¤ä»£': 'å†å²', 'è¿‘ä»£': 'å†å²', 'å†å²äº‹ä»¶': 'å†å²',
  // åœ°ç†
  'geography': 'åœ°ç†', 'åœ°ç†': 'åœ°ç†', 'æ°”å€™': 'åœ°ç†', 'åœ°å½¢': 'åœ°ç†', 'åŒºåŸŸ': 'åœ°ç†',
  'åŸå¸‚': 'åœ°ç†', 'è‡ªç„¶': 'åœ°ç†', 'ç¯å¢ƒ': 'åœ°ç†',
  // æ”¿æ²»
  'politics': 'æ”¿æ²»', 'æ”¿æ²»': 'æ”¿æ²»', 'æ”¿ç­–': 'æ”¿æ²»', 'åˆ¶åº¦': 'æ”¿æ²»', 'æ³•å¾‹': 'æ”¿æ²»',
  'å“²å­¦': 'æ”¿æ²»', 'æ€æƒ³': 'æ”¿æ²»',
  // ç¼–ç¨‹
  'programming': 'ç¼–ç¨‹', 'ç¼–ç¨‹': 'ç¼–ç¨‹', 'ä»£ç ': 'ç¼–ç¨‹', 'python': 'ç¼–ç¨‹', 'java': 'ç¼–ç¨‹',
  'javascript': 'ç¼–ç¨‹', 'ç¨‹åº': 'ç¼–ç¨‹', 'å¼€å‘': 'ç¼–ç¨‹', 'ç®—æ³•': 'ç¼–ç¨‹',
  // è®¡ç®—æœº
  'computer': 'è®¡ç®—æœº', 'è®¡ç®—æœº': 'è®¡ç®—æœº', 'è½¯ä»¶': 'è®¡ç®—æœº', 'ç¡¬ä»¶': 'è®¡ç®—æœº',
  'ç½‘ç»œ': 'è®¡ç®—æœº', 'ç³»ç»Ÿ': 'è®¡ç®—æœº', 'æ•°æ®åº“': 'è®¡ç®—æœº',
  // è‰ºæœ¯
  'art': 'è‰ºæœ¯', 'è‰ºæœ¯': 'è‰ºæœ¯', 'ç»˜ç”»': 'è‰ºæœ¯', 'ç¾æœ¯': 'è‰ºæœ¯', 'è®¾è®¡': 'è‰ºæœ¯',
  'è‰²å½©': 'è‰ºæœ¯', 'åˆ›ä½œ': 'è‰ºæœ¯',
  // éŸ³ä¹
  'music': 'éŸ³ä¹', 'éŸ³ä¹': 'éŸ³ä¹', 'æ­Œæ›²': 'éŸ³ä¹', 'ä¹å™¨': 'éŸ³ä¹', 'æ—‹å¾‹': 'éŸ³ä¹',
  'èŠ‚å¥': 'éŸ³ä¹', 'éŸ³ç¬¦': 'éŸ³ä¹',
  // ä½“è‚²
  'sports': 'ä½“è‚²', 'ä½“è‚²': 'ä½“è‚²', 'é”»ç‚¼': 'ä½“è‚²', 'å¥èº«': 'ä½“è‚²', 'æ¯”èµ›': 'ä½“è‚²', 'è®­ç»ƒ': 'ä½“è‚²',
  // é€šè¯†
  'å­¦ä¹ æ–¹æ³•': 'å­¦ä¹ æ–¹æ³•', 'å­¦ä¹ æŠ€å·§': 'å­¦ä¹ æ–¹æ³•', 'è®°å¿†': 'å­¦ä¹ æ–¹æ³•', 'å¤ä¹ ': 'å­¦ä¹ æ–¹æ³•',
  'ç¬”è®°': 'ç¬”è®°', 'æ€ç»´å¯¼å›¾': 'å­¦ä¹ æ–¹æ³•', 'æ•ˆç‡': 'å­¦ä¹ æ–¹æ³•',
  'è€ƒè¯•': 'è€ƒè¯•æŠ€å·§', 'exam': 'è€ƒè¯•æŠ€å·§', 'æµ‹éªŒ': 'è€ƒè¯•æŠ€å·§', 'ç­”é¢˜': 'è€ƒè¯•æŠ€å·§', 'è§£é¢˜': 'è€ƒè¯•æŠ€å·§',
  'é˜…è¯»': 'é˜…è¯»', 'reading': 'é˜…è¯»', 'ä¹¦ç±': 'é˜…è¯»', 'æ–‡ç« ': 'é˜…è¯»',
  'æ€ç»´': 'æ€ç»´è®­ç»ƒ', 'é€»è¾‘': 'æ€ç»´è®­ç»ƒ', 'æ¨ç†': 'æ€ç»´è®­ç»ƒ', 'æ€è€ƒ': 'æ€ç»´è®­ç»ƒ', 'åˆ†æ': 'æ€ç»´è®­ç»ƒ',
  'é¡¹ç›®': 'é¡¹ç›®',
};

/**
 * æ ¹æ®åˆ†ç±»è·å–æ˜¾ç¤ºé…ç½®
 * @param {string} category - åˆ†ç±»åç§°
 * @returns {Object} æ˜¾ç¤ºé…ç½®å¯¹è±¡
 */
export function getSubjectConfig(category) {
  // ç›´æ¥åŒ¹é…
  if (subjectConfigs[category]) {
    return subjectConfigs[category];
  }
  
  // æ¨¡ç³ŠåŒ¹é…
  const lowerCat = (category || '').toLowerCase();
  for (const [keyword, subject] of Object.entries(keywordMapping)) {
    if (lowerCat.includes(keyword.toLowerCase())) {
      return subjectConfigs[subject] || subjectConfigs['é»˜è®¤'];
    }
  }
  
  return subjectConfigs['é»˜è®¤'];
}

/**
 * è·å–åˆ†ç±»çš„é¢œè‰²
 * @param {string} category - åˆ†ç±»åç§°
 * @returns {string} é¢œè‰²å€¼
 */
export function getCategoryColor(category) {
  return getSubjectConfig(category).color;
}

/**
 * è·å–åˆ†ç±»çš„æ¸å˜è‰²
 * @param {string} category - åˆ†ç±»åç§°
 * @returns {string} CSSæ¸å˜å€¼
 */
export function getCategoryGradient(category) {
  return getSubjectConfig(category).gradient;
}

/**
 * è·å–åˆ†ç±»çš„å›¾æ ‡
 * @param {string} category - åˆ†ç±»åç§°
 * @returns {string} Iconifyå›¾æ ‡å
 */
export function getCategoryIcon(category) {
  return getSubjectConfig(category).icon;
}

/**
 * è·å–åˆ†ç±»çš„Emoji
 * @param {string} category - åˆ†ç±»åç§°
 * @returns {string} Emojiå­—ç¬¦
 */
export function getCategoryEmoji(category) {
  return getSubjectConfig(category).emoji;
}

/**
 * è·å–åˆ†ç±»çš„æµ…è‰²èƒŒæ™¯
 * @param {string} category - åˆ†ç±»åç§°
 * @returns {string} èƒŒæ™¯è‰²å€¼
 */
export function getCategoryLightBg(category) {
  return getSubjectConfig(category).lightBg;
}

/**
 * è·å–æ‰€æœ‰å¯ç”¨çš„åˆ†ç±»åˆ—è¡¨
 * @returns {Array<string>} åˆ†ç±»åç§°æ•°ç»„
 */
export function getAllCategories() {
  return Object.keys(subjectConfigs).filter(k => k !== 'é»˜è®¤');
}

/**
 * EChartsé¥¼å›¾çš„æ¸å˜è‰²é…ç½®ç”Ÿæˆ
 * @param {Array} data - åˆ†å¸ƒæ•°æ®
 * @returns {Array} å¸¦æ¸å˜è‰²çš„é¥¼å›¾æ•°æ®
 */
export function generatePieChartData(data) {
  const gradientColors = [
    ['#3b82f6', '#1d4ed8'], // è“è‰²
    ['#f59e0b', '#d97706'], // æ©™è‰²
    ['#ec4899', '#db2777'], // ç²‰è‰²
    ['#8b5cf6', '#6d28d9'], // ç´«è‰²
    ['#10b981', '#059669'], // ç»¿è‰²
    ['#06b6d4', '#0891b2'], // é’è‰²
    ['#f97316', '#ea580c'], // æ©˜è‰²
    ['#84cc16', '#65a30d'], // é…¸æ©™
  ];

  return data.map((item, index) => {
    const config = getSubjectConfig(item.category);
    const colorPair = gradientColors[index % gradientColors.length];
    
    return {
      value: item.count || 0,
      name: item.category,
      itemStyle: {
        color: {
          type: 'linear',
          x: 0, y: 0, x2: 1, y2: 1,
          colorStops: [
            { offset: 0, color: config.color || colorPair[0] },
            { offset: 1, color: colorPair[1] || config.color }
          ]
        }
      }
    };
  });
}

export default {
  subjectConfigs,
  getSubjectConfig,
  getCategoryColor,
  getCategoryGradient,
  getCategoryIcon,
  getCategoryEmoji,
  getCategoryLightBg,
  getAllCategories,
  generatePieChartData,
};
